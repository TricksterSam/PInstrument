# PInstrument

## What is it?
PInstrument is a set of modules for audio synthesis built in Pure Data designed to run on a small touch screen. Specifically, the interface is designed to work on a 320x240 2.8 inch TFT Capacitive Touchscreen but it will work on any larger screen. The PInstrument is also designed to run on a low-power CPU like those in a Raspberry Pi 3 or 4. It was also designed with a 4in/8out DC-coupled interface to be used with a Eurorack synthesizer. As of 2021, Expert Sleepers produces both the ES-8 and ES-9 that will solve these purposes.

## Contributing
Others are welcome to contribute to this project or to fork it off for their own and reuse components. For those assisting in this project, keep in mind the small form factor of the interface, the limitations of a Raspberry Pi, and the public license provided with this software.

Other considerations involve how signals are used in Eurorack. In general an audio signal in these patches should range from -1 to +1 rms which is -10 to +10V in Eurorack. Control signals should range from 0 to 1 rms which is 0 to 10V Eurorack. These signals can often be interchanged, but when designing a module consider whether a control signal should be put through an envelope follower, whether it is appropriate to take its absolute value, or whether you should scale and recenter it.

## How to use it
You can run this on any computer that can run Pure Data. If you'd like to use this in a Eurorack setup on a Raspberry Pi, I recommend the following:

1. Raspberry Pi 3 or 4
2. Expert Sleepers [ES-8](https://www.expert-sleepers.co.uk/es8.html) or [ES-9](https://www.expert-sleepers.co.uk/es9.html) audio interface.
3. Adafruit [PiTFT 320x240 TFT Capacitive Touchscreen](https://www.adafruit.com/product/2423) or something larger. Mouse and keyboard work as well.

With a little effort, you can script the Pi to boot Pure Data and your patch and choose your audio interface as it starts up.

## Growing module library
The initial modules available are listed below. The touchscreen interface displays to the user a scrollable selection menu and the interface for one module. Selecting another module from the menu will display its controls. All modules run at the same time and can be patched together, no Eurorack needed! Input and output selectors can select audio interfaces inputs and outputs. These are displayed as numbers. Input and output selectors can also select internal routing, displayed as letters. The project includes a Pure Data abstraction that you can use to add these input and output selectors to your own project. Make sure to get the routing subpatch or they won't work!

Color Coding helps the user understand the controls. Green objects are tunable or toggleable parameters. Blue objects are input selectors. Grey objects are output selectors.

### Relabi Waves
Four chained sine wave oscillators generate complex frequency modulated waveforms for control. Each oscillator has an identical set of controls. 

1. Course and fine tuning depend on finger placement. 
2. An external or internal signal can be used to reset the phase of the wave. 
3. The first output is the waveform's full amplitude. 
4. The second is an amplitude modulated output affected 20% by the previous oscillator in the series.
5. The third is a gate that is high when the oscillator's amplitude is greater than the amplitude of the oscillator before it in the series.

### Turing Maching
Musically useful patterns automatically arise and modify themselves. These values are created by a sequence of bits. A trigger cycles through this sequence generating a repeating set of values.

Controls:
1. Min sets the lowest MIDI note number to output in the series.
2. Max sets the highest MIDI note number to output in the series.
3. N steps divides the range of the min to max into an number of intervals of equal size.
4. Length controls how many values are generated by the sequence.
5. Rand determines the chance that a bit will flip from 0 to 1 or 1 to 0.
6. QNT turns on equal tempered quantization.

Inputs and Outputs:
1. Trigger generates a new value when the input crosses a threshold.
2. Maximum receives a signal to set the Max MIDI note number of the series.
3. Steps receives a signal to control the number quantization steps for the range of values generated.
4. Random receives a signal to control how high a chance there is of a bit to flip.
5. Output sends the signal (in Pd as an audio rate rms 0 to 1 and through the Expert Sleepers as 0 to 10V).

### Phase Sequence
Phase Sequence is a phase sequencer with up to 18 steps with specific octave placement.

Controls:
1. N steps sets how many steps to read through in the sequence, up to 18.
2. 18 Pitch selectors allow the assignment of a specific pitch from C0 to E8.

Inputs and Outputs:
1. CV Select receives a signal to choose on of the steps in the sequence. The input signal's range in Pd is 0 to 1 rms and in Eurorack 0 to 10V. This range is limited to the number of steps selected.
2. Trigger changes the output value to the current step selected by the signal in CV select.
3. Output sends a continuous signal of the last selected step that was triggered. This signal is 0 to 1 rms in Pd with 0.1 rms per octave and 0 to 10V in Eurorack with 1V per octave.

Diplays:
1. A series of white exes flash to show the current status of each bit in the cycle.
2. A percentage shows the value of the current configuration of bits from 0 to 100%.
3. A note display shows the current MIDI note that results from the current set of bits as affected by the minimum and maximum pitch values and the interval step size.

### Wave Folder
Wave folder makes a signal harmonically richer by reflecting it when it exceeds a threshold.

Controls:
1. Folds controls the number of extra harmonics that result from folding.
2. Fold Atten controls the attenuation of the Fold CV that modulates the Fold parameter.
3. Slew controls how quickly changes to Folds and Amps occur.
4. Amp amplifies the audio input which can affect how much of the waveform gets folded.
5. Amp Atten controls the attenuation of the Amp CV that modulates the Amp parameter.

Inputs and Outputs:
1. Audio Input receives a signal. In Pd this signal is -1 to +1 rms and in Eurorack -10 to +10V. Exceeding these values is possible and will result in more of the waveform undergoing folding.
2. Fold CV takes in a signal (0 to 1 rms / 0 to 10V Euro) and uses it to modify the Fold parameter.
3. Amp CV takes in a signal (0 to 1 rms / 0 to 10V Euro) and uses it to modify the Amp parameter.
4. Left Out and Right Out are copies of each other and output signals (-1 to +1 rms / -10 to 10V Euro).

### VCA Panner
This is a four channel VCA that can also be used for panning and mixing.

Controls:
1. Attenuate affects how much the CV signal modulates the amplitude of the input signal.

Inputs and Outputs:
Each channel has two inputs and two outputs and are identical in function.
1. Input receives a signal (-1 to +1 rms / -10 to 10V Euro).
2. CV receives a signal and tracks its envelope. This is used to modulate the amplitude of the Input based on the Attenuate parameter.
3. Left Out sends the modulated version of the Input. (-1 to +1 rms / -10 to 10V Euro)
4. Right Out is the opposite of Left Out. When amplitude on the left is high, right will be low, allowing the Input to be panned. (-1 to +1 rms / -10 to 10V Euro)
All channels are mixed into the Left Mix and Right Mix outputs. (-1 to +1 rms / -10 to 10V Euro)

### Quad Cosines
This is a four channel VCO that produces only cosine waveforms.

Controls:
All four generators have identical function and controls.
1. Range in octaves.
2. 8v Offset controls which octave is at the very bottom of the range.
3. Step Offset controls which pitch is at the very bottom of the range.
4. Quantize constrains the Freq CV input to an equal tempered scale.

Inputs and Outputs:
1. Freq CV receives a signal (0 to 1 rms / 0 to 10V Euro) which sweeps through the assigned range of notes.
2. OSC Out sends a signal (-1 to +1 rms / -10 to 10V Euro).

### Clocks
Runs four channels off one clock. The tempo can be modulated by an external signal. The bottom two clock dividers can also be used to generate clock-synced waveforms.

Controls:
All four clock dividers have the following:
1. Multiplier extends the clock beat by an integeral multiplier.
2. Divisor repeats the clock a number of times equal to the given integer.  

The bottom two clocks additionally have a wave selector and an extra output. The selected waveform is clock synced to the given multiplier/divisor ratio. Choices include sign, triangle, descending sawtooth, and square.

Additional controls:
1. Attenuate adjusts how much the Tempo CV signal affects the tempo.
2. Switch turns the master clock on and off.
3. N BPM controls the rate of the master clock in beats per minute.

Inputs and Outputs:
1. Tempo CV receives a control signal (0 to 1 rms / 0 to 10V Euro) that modifies the rate of the clock.
2. Each clock divider has a clock out that sends a short signal pulse (1 rms in Pd / 10V in Euro).
3. The bottom clock dividers have a waveform output that sends a clock-synced waveform (0 to 1 rms / 0 to 10V Euro).

### Drums
Drums is a quick mockup of a drum synth which includes a hihat, clap, snare, and kick drum as well as a side chain that will be compressed on each kickdrum pulse.

Controls:
1. Each drum has a row of eight toggles which can be used to create patterns.
2. The Sync button causes all four patterns to return to their first step. They can quickly become out of sync if they each have a different trigger source.

Inputs and Outputs:
1. Each drum has a trigger input. A high rms or Eurorack voltage will trigger that drum's channel. Each drum can be assigned to receive their trigger from a different input source.
2. Two side chain inputs each receive an audio signal (-1 to +1 rms / -10 to 10V Euro) which go to the side chain outputs.
3. Each drum has an signal output. They output an audio signal when triggered (-1 to +1 rms / -10 to 10V Euro).
4. Two side chain outputs send audio signals (-1 to +1 rms / -10 to 10V Euro) and are compressed whenever the kickdrum is triggered.

### Pitch Tracker
Pitch Tracker follows the pitch of three signals and outputs appropriate control voltages to control other modules' volt per octave inputs.

Controls:
1. Each channel has a Quantized toggle that will restrain the output pitch to an equal tempered scale. When off, there are no tuning constraints.
2. Each channel has a Portamento slider that sets the time it takes to ramp from the previous pitch to the new pitch. This range is logarithmic from 0.9ms (displayed as 0) to 999ms.

Inputs and Outputs:
Each channel has identical functionality and controls.
1. Audio Input takes in an audio signal (-1 to +1 rms / -10 to 10V Euro) and tracks its pitch and amplitude.
2. Discr Pitch outputs discrete pitches that are detected from the input to the selected destination. These pitches are 0.1 rms per octave in Pd and 1V per octave in Eurorack.
3. Conti Pitch outputs pitch continuously to the selected destination. The values for pitch are the same as above.
4. Envelope outputs the amplitude of the incoming signal continuously (-1 to +1 rms / -10 to 10V Euro).

Displays:
Three displays show the current pitch an octave for each channel.

